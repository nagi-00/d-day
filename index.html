<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moment Cooker by nagi</title>
    <style>
        :root {
            --theme-color: #ffffff;
            --accent-color: #1d1d1f;
            --hover-color: rgba(0, 0, 0, 0.04);
            --shadow-pale: 0 4px 4px rgba(0,0,0,0.06);
            --dark-theme-color: #333;
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "SF Pro Display", "Inter", sans-serif;
        }

        * { box-sizing: border-box; font-family: var(--font-family); letter-spacing: -0.01em; }
        html, body { margin: 0; padding: 0; }
        body { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: #f5f5f7; padding: 20px; transition: background 0.3s; }

        /* Main Layout Container */
        .main-container {
            display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 40px;
            width: 100%; max-width: 800px;
        }

        @media (max-width: 720px), (max-aspect-ratio: 4/5) {
            .main-container { flex-direction: column; gap: 25px; }
        }

        /* Window Style */
        .window {
            width: 100%; max-width: 420px; background: #fff; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); overflow: hidden;
            border: 1px solid rgba(0,0,0,0.06); display: flex; flex-direction: column;
            z-index: 10; flex-shrink: 0;
        }
        .title-bar { height: 50px; background: #fff; display: flex; align-items: center; padding: 0 16px; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .dots { display: flex; gap: 7px; flex: 1; }
        .dot { width: 11px; height: 11px; border-radius: 50%; }
        .dot.red { background: #e8bcbc; } .dot.yellow { background: #f4f4bd; } .dot.green { background: #c5e8c5; }
        .bar-title { font-size: 13px; font-weight: 700; color: #333; flex: 2; text-align: center; }
        .nav-controls { flex: 1; display: flex; justify-content: flex-end; gap: 12px; }

        .content { padding: 30px 25px; min-height: 280px; position: relative; overflow-y: auto; }
        .step { display: none; animation: fadeUp 0.3s ease; }
        .step.active { display: block; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        h1 { font-size: 20px; font-weight: 800; margin: 0 0 8px; color: #1d1d1f; }
        p { font-size: 13px; color: #86868b; margin-bottom: 20px; line-height: 1.4; }
        input, select, textarea { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #eee; background: #f9f9fc; outline: none; font-size: 13px; margin-bottom: 10px; transition: all 0.2s; }
        textarea { height: 80px; resize: none; }
        input:focus, textarea:focus { border-color: #1d1d1f; background: #fff; }

        .label-text { font-size: 11px; font-weight: 700; color: #999; margin-bottom: 6px; display: block; text-transform: uppercase; letter-spacing: 0.03em; }

        .nav-btn { background: none; border: none; cursor: pointer; color: #1d1d1f; transition: opacity 0.2s; padding: 5px; display: flex; align-items: center; justify-content: center; }
        .nav-btn:disabled { opacity: 0.1; cursor: default; }

        .input-list { display: flex; flex-direction: column; gap: 8px; margin-bottom: 10px; }
        .input-row { display: flex; gap: 8px; align-items: center; }
        .input-row input { margin-bottom: 0; flex: 1; }
        .input-row .remove-btn { width: 32px; height: 32px; border-radius: 8px; border: none; background: #f0f0f0; color: #999; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; }
        .add-btn { padding: 10px 16px; border-radius: 10px; border: 1px dashed #ddd; background: transparent; color: #999; cursor: pointer; font-size: 12px; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 6px; }

        /* Widget Appearance */
        .widget-frame {
            width: 176px; height: 224px; background: #ffffff; border-radius: 29px;
            overflow: hidden; display: flex; flex-direction: column;
            border: 1px solid rgba(0,0,0,0.08); position: relative; transition: all 0.5s ease; flex-shrink: 0;
        }
        .widget-frame.with-shadow { box-shadow: 0 2px 8px rgba(0,0,0,0.08), 0 1px 3px rgba(0,0,0,0.06); }

        .widget-bg-layer { position: absolute; inset: 0; opacity: var(--bg-opacity, 0); filter: blur(35px); z-index: 1; pointer-events: none; transition: opacity 0.5s ease; }

        .widget-content { flex: 1; display: flex; flex-direction: column; align-items: flex-start; justify-content: space-between; padding: 22px 19px; z-index: 2; position: relative; }

        .image-wrapper { position: relative; align-self: center; margin-bottom: 10px; }
        .image-container { width: 45px; height: 45px; overflow: hidden; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 14px rgba(0, 0, 0, 0.08); background: #fff; }
        .image-container img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.2s ease; }
        .image-container.circle { border-radius: 50%; }
        .image-container.square { border-radius: 11px; }

        .image-tooltip {
            position: absolute; top: calc(100% + 6px); left: 50%; transform: translateX(-50%) translateY(-3px);
            padding: 8px 14px; border-radius: 12px; font-size: 11px; font-weight: 600; opacity: 0; pointer-events: none;
            transition: all 0.3s ease; width: max-content; max-width: 150px; text-align: center; line-height: 1.4;
            white-space: normal; word-break: keep-all; z-index: 100;
        }
        .image-tooltip.dark { background: rgba(0,0,0,0.5); color: #fff; backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .image-tooltip.light { background: rgba(255,255,255,0.6); color: #1d1d1f; backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(0,0,0,0.08); }
        .image-wrapper:hover .image-tooltip { opacity: 1; transform: translateX(-50%) translateY(0); }

        .text-group { text-align: left; width: 100%; flex: 1; display: flex; flex-direction: column; justify-content: center; }
        .dday-text { font-size: 12px; font-weight: 800; color: #1d1d1f; margin-bottom: 3px; }
        .desc-text { font-size: 9px; font-weight: 500; color: #666; line-height: 1.5; word-break: break-word; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; }

        .bottom-area { width: 100%; display: flex; justify-content: flex-end; align-items: center; margin-top: 6px; }

        .confirm-btn {
            padding: 6px 13px; border-radius: 8px; background: #1d1d1f; border: none; cursor: pointer;
            font-size: 9px; font-weight: 700; color: #fff; box-shadow: 0 3px 10px rgba(0,0,0,0.12);
            transition: all 0.15s ease;
        }
        .confirm-btn:hover { transform: translateY(-2px); }

        .particle { position: absolute; pointer-events: none; font-size: 16px; bottom: 40px; right: 35px; animation: chimneyFlow 2.5s cubic-bezier(0.22, 1, 0.36, 1) forwards; z-index: 10; }
        @keyframes chimneyFlow {
            0% { transform: translate(0, 0) scale(0.4); opacity: 0; }
            15% { opacity: 1; }
            100% { transform: translate(var(--rand-x), -150px) scale(1.3) rotate(var(--rand-r)); opacity: 0; }
        }

        #toast { position: fixed; bottom: -60px; left: 50%; transform: translateX(-50%); background: #1d1d1f; color: #fff; padding: 14px 28px; border-radius: 20px; font-size: 14px; transition: 0.4s; z-index: 200; }
        #toast.show { bottom: 40px; }

        body.is-embed { background: transparent !important; padding: 12px !important; margin: 0 !important; display: flex !important; align-items: center !important; justify-content: center !important; }
        body.is-embed .window, body.is-embed #toast { display: none !important; }
    </style>
</head>
<body>

    <div class="main-container">
        <div class="window" id="setupWindow">
            <div class="title-bar">
                <div class="dots"><div class="dot red"></div><div class="dot yellow"></div><div class="dot green"></div></div>
                <div class="bar-title">Moment Cooker</div>
                <div class="nav-controls">
                    <button class="nav-btn" id="prevBtn" onclick="moveStep(-1)" disabled><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M15 18l-6-6 6-6"/></svg></button>
                    <button class="nav-btn" id="nextBtn" onclick="moveStep(1)"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg></button>
                </div>
            </div>
            <div class="content">
                <div class="step active" id="step1">
                    <h1>The Moment</h1>
                    <p>ê¸°ë¡í•˜ê³  ì‹¶ì€ ë‚ ì§œì™€ ì´ì•¼ê¸°ë¥¼ ì ì–´ì£¼ì„¸ìš”. íˆ´íŒì€ ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ëœë¤í•˜ê²Œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p>
                    <label class="label-text">Titles (Tooltip ğŸ’¬)</label>
                    <div class="input-list" id="titleList">
                        <div class="input-row"><input type="text" placeholder="ìš°ë¦¬ ì²˜ìŒ ë§Œë‚œ ë‚ " oninput="updatePreview()"></div>
                    </div>
                    <button class="add-btn" onclick="addTitleInput()">+ Add another</button>
                    <label class="label-text" style="margin-top:15px;">Tooltip Style</label>
                    <select id="tooltipStyleSelect" onchange="updatePreview()"><option value="dark">Dark ğŸ–¤</option><option value="light">Light ğŸ¤</option></select>
                    <label class="label-text">Date</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="date" id="dateInput" onchange="updatePreview()" style="flex: 1; margin-bottom: 0;">
                        <select id="dateDisplaySelect" onchange="updatePreview()" style="flex: 1; margin-bottom: 0;"><option value="dday">D-day</option><option value="date">Date</option></select>
                    </div>
                    <label class="label-text">Stories</label>
                    <textarea id="descInput" placeholder="ì´ê³³ì— ì§§ì€ ì´ì•¼ê¸°ë¥¼ ì ì–´ì£¼ì„¸ìš”." oninput="updatePreview()"></textarea>
                </div>

                <div class="step" id="step2">
                    <h1>Visual & Shape</h1>
                    <p>ìœ„ì ¯ì˜ ë¶„ìœ„ê¸°ì™€ ì´ë¯¸ì§€ êµ¬ë„ë¥¼ ì„¸ë°€í•˜ê²Œ ì¡°ì •í•´ë³´ì„¸ìš”.</p>
                    <label class="label-text">Theme Color & Opacity</label>
                    <div style="display: flex; gap: 12px; align-items: center; margin-bottom: 12px;">
                        <input type="color" id="themeColorPicker" value="#a4c4e4" oninput="updatePreview()" style="width: 50px; height: 40px; border:none; padding:0; background:none; cursor:pointer;">
                        <input type="range" id="opacityRange" min="0" max="100" value="15" oninput="updatePreview()" style="flex: 1;">
                    </div>
                    <label class="label-text">Coloring Style</label>
                    <select id="bgStyleSelect" onchange="updatePreview()" style="margin-bottom: 15px;">
                        <option value="complementary">Watercolor</option>
                        <option value="analogous">Soft</option>
                        <option value="solid">Solid Color</option>
                    </select>
                    <label class="label-text">Image Shape & URL</label>
                    <select id="shapeSelect" onchange="updatePreview()"><option value="square">Square</option><option value="circle">Circle</option></select>
                    <input type="text" id="imageUrlInput" placeholder="ì´ë¯¸ì§€ ì£¼ì†Œ(URL)ë¥¼ ì…ë ¥í•˜ì„¸ìš”" oninput="updatePreview()">
                    
                    <label class="label-text">Image Zoom & Position</label>
                    <div style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 12px;">
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <span style="font-size: 11px; color: #666; width: 35px;">Zoom</span>
                            <input type="range" id="imgZoomRange" min="100" max="300" value="100" oninput="updatePreview()" style="flex: 1; margin: 0;">
                            <span id="zoomValue" style="font-size: 11px; color: #999; width: 35px; text-align: right;">1.0x</span>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <span style="font-size: 11px; color: #666; width: 35px;">X</span>
                            <input type="range" id="imgPosX" min="-50" max="50" value="0" step="0.5" oninput="updatePreview()" style="flex: 1; margin: 0;">
                            <span style="width: 35px;"></span>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <span style="font-size: 11px; color: #666; width: 35px;">Y</span>
                            <input type="range" id="imgPosY" min="-50" max="50" value="0" step="0.5" oninput="updatePreview()" style="flex: 1; margin: 0;">
                            <span style="width: 35px;"></span>
                        </div>
                        <div style="display: flex; justify-content: center; margin-top: 4px;">
                            <button type="button" onclick="resetImagePos()" style="padding: 6px 20px; border-radius: 8px; border: 1px solid #eee; background: #fff; color: #86868b; font-size: 11px; font-weight: 600; cursor: pointer;">Reset Position</button>
                        </div>
                    </div>
                </div>

                <div class="step" id="step3">
                    <h1>Interaction</h1>
                    <p>ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œ í©ë‚ ë¦´ ì´ëª¨ì§€ë“¤ì„ ë“±ë¡í•´ë³´ì„¸ìš”.</p>
                    <label class="label-text">Button Label</label>
                    <input type="text" id="btnTextInput" maxlength="8" placeholder="Check" oninput="updatePreview()">
                    <label class="label-text">Particles (Emoji âœ¨)</label>
                    <div class="input-list" id="particleList">
                        <div class="input-row"><input type="text" placeholder="ğŸ¤" maxlength="4" oninput="updatePreview()"></div>
                    </div>
                    <button class="add-btn" onclick="addParticleInput()">+ Add another</button>
                </div>
            </div>
        </div>

        <div class="widget-frame with-shadow" id="wFrame">
            <div class="widget-bg-layer" id="bgLayer"></div>
            <div class="widget-content">
                <div class="image-wrapper">
                    <div class="image-tooltip dark" id="wTooltip">ê¸°ì–µì˜ ì¡°ê°</div>
                    <div class="image-container square" id="imgContainer">
                        <img id="wImg" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23a4c4e4'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E">
                    </div>
                </div>
                <div class="text-group">
                    <div id="wDday" class="dday-text">D+0</div>
                    <div id="wDesc" class="desc-text" style="white-space: pre-wrap;">ì´ê³³ì— ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</div>
                </div>
                <div class="bottom-area">
                    <span style="font-size: 8px; color: rgba(0,0,0,0.15); margin-right: auto; letter-spacing: 0.05em; font-weight: 400;">Â© nagi</span>
                    <button class="confirm-btn" id="actionBtn" onclick="spawnParticles()">Check</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast">ğŸ¤ ì„¤ì • ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ë…¸ì…˜ì— ì„ë² ë“œí•˜ì„¸ìš”.</div>

<script>
    let currentStep = 1;
    let titles = ["ê¸°ì–µì˜ ì¡°ê°"];
    let particles = ["ğŸ¤"];
    const params = new URLSearchParams(window.location.search);

    function getAnalogousColors(hex) {
        const r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16);
        return [`rgba(${r}, ${g}, ${b}, 1)`, `rgba(${Math.min(255, r+30)}, ${g}, ${b}, 0.7)`, `rgba(${r}, ${g}, ${Math.min(255, b+30)}, 0.6)`];
    }

    function getContrastYIQ(hex){
        hex = hex.replace("#", "");
        var r = parseInt(hex.substr(0,2),16), g = parseInt(hex.substr(2,2),16), b = parseInt(hex.substr(4,2),16);
        return (((r*299)+(g*587)+(b*114))/1000 >= 128) ? '#1d1d1f' : '#ffffff';
    }

    function addTitleInput() {
        const list = document.getElementById('titleList');
        const row = document.createElement('div');
        row.className = 'input-row';
        row.innerHTML = `<input type="text" placeholder="ë¬¸êµ¬ ì¶”ê°€..." oninput="updatePreview()"><button class="remove-btn" onclick="this.parentElement.remove();updatePreview();">Ã—</button>`;
        list.appendChild(row);
    }

    function addParticleInput() {
        const list = document.getElementById('particleList');
        const row = document.createElement('div');
        row.className = 'input-row';
        row.innerHTML = `<input type="text" placeholder="âœ¨" maxlength="4" oninput="updatePreview()"><button class="remove-btn" onclick="this.parentElement.remove();updatePreview();">Ã—</button>`;
        list.appendChild(row);
    }

    function resetImagePos() {
        document.getElementById('imgZoomRange').value = 100;
        document.getElementById('imgPosX').value = 0;
        document.getElementById('imgPosY').value = 0;
        updatePreview();
    }

    function spawnParticles() {
        const particleArr = params.get('embed') ? particles : Array.from(document.querySelectorAll('#particleList input')).map(i => i.value.trim()).filter(v => v);
        const emoji = particleArr[Math.floor(Math.random() * particleArr.length)] || "ğŸ¤";
        const p = document.createElement('div');
        p.className = 'particle'; p.innerText = emoji;
        p.style.setProperty('--rand-x', `${(Math.random() - 0.5) * 80}px`);
        p.style.setProperty('--rand-r', `${(Math.random() - 0.5) * 70}deg`);
        document.getElementById('wFrame').appendChild(p);
        setTimeout(() => p.remove(), 2500);
    }

    function updatePreview() {
        const titleInputs = document.querySelectorAll('#titleList input');
        const titleArr = Array.from(titleInputs).map(i => i.value.trim()).filter(v => v);
        const themeColor = document.getElementById('themeColorPicker').value;
        const opacity = document.getElementById('opacityRange').value / 100;
        
        // íˆ´íŒ & í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        document.getElementById('wTooltip').innerText = titleArr[0] || "ê¸°ì–µì˜ ì¡°ê°";
        document.getElementById('wTooltip').className = `image-tooltip ${document.getElementById('tooltipStyleSelect').value}`;
        document.getElementById('wDesc').innerText = document.getElementById('descInput').value || "ì´ê³³ì— ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.";
        
        // ë°°ê²½ ì„¤ì •
        const bgLayer = document.getElementById('bgLayer');
        const bgStyle = document.getElementById('bgStyleSelect').value;
        bgLayer.style.opacity = opacity;
        if (bgStyle === 'solid') { bgLayer.style.background = themeColor; bgLayer.style.filter = 'none'; }
        else {
            const colors = getAnalogousColors(themeColor);
            bgLayer.style.background = `radial-gradient(circle at 80% 20%, ${colors[0]} 0%, transparent 50%), radial-gradient(circle at 20% 80%, ${colors[1]} 0%, transparent 60%)`;
            bgLayer.style.filter = 'blur(35px)';
        }

        // ì´ë¯¸ì§€ ìœ„ì¹˜ ë° ì¤Œ
        const zoom = document.getElementById('imgZoomRange').value / 100;
        const posX = document.getElementById('imgPosX').value;
        const posY = document.getElementById('imgPosY').value;
        document.getElementById('zoomValue').innerText = zoom.toFixed(1) + 'x';
        document.getElementById('wImg').style.transform = `scale(${zoom}) translate(${posX/zoom}%, ${posY/zoom}%)`;
        document.getElementById('imgContainer').className = `image-container ${document.getElementById('shapeSelect').value}`;
        if (document.getElementById('imageUrlInput').value) document.getElementById('wImg').src = document.getElementById('imageUrlInput').value;

        // D-day ê³„ì‚°
        const dateVal = document.getElementById('dateInput').value;
        if (dateVal) {
            if (document.getElementById('dateDisplaySelect').value === 'date') {
                document.getElementById('wDday').innerText = dateVal.replace(/-/g, '.');
            } else {
                const diff = Math.floor((new Date().setHours(0,0,0,0) - new Date(dateVal).setHours(0,0,0,0)) / 86400000);
                document.getElementById('wDday').innerText = diff >= 0 ? `D+${diff}` : `D${diff}`;
            }
        }
    }

    async function moveStep(n) {
        if (currentStep + n === 4) {
            // URL íŒŒë¼ë¯¸í„° ìƒì„± ë° ë³µì‚¬ ë¡œì§ (ê¸°ì¡´ê³¼ ë™ì¼)
            const t = btoa(encodeURIComponent(Array.from(document.querySelectorAll('#titleList input')).map(i => i.value).join('|')));
            const d = document.getElementById('dateInput').value;
            const ds = btoa(encodeURIComponent(document.getElementById('descInput').value));
            const th = document.getElementById('themeColorPicker').value.replace('#', '');
            const op = document.getElementById('opacityRange').value;
            const img = btoa(encodeURIComponent(document.getElementById('imageUrlInput').value));
            const iz = document.getElementById('imgZoomRange').value;
            const ix = document.getElementById('imgPosX').value;
            const iy = document.getElementById('imgPosY').value;
            const p = btoa(encodeURIComponent(Array.from(document.querySelectorAll('#particleList input')).map(i => i.value).join('|')));
            
            const url = `${window.location.origin}${window.location.pathname}?embed=true&t=${t}&d=${d}&ds=${ds}&th=${th}&op=${op}&img=${img}&iz=${iz}&ix=${ix}&iy=${iy}&p=${p}&s=${document.getElementById('shapeSelect').value}&ts=${document.getElementById('tooltipStyleSelect').value}&dd=${document.getElementById('dateDisplaySelect').value}&bt=${btoa(encodeURIComponent(document.getElementById('btnTextInput').value))}`;
            
            await navigator.clipboard.writeText(url);
            document.getElementById('toast').classList.add('show');
            setTimeout(() => document.getElementById('toast').classList.remove('show'), 3000);
            return;
        }
        document.getElementById(`step${currentStep}`).classList.remove('active');
        currentStep += n;
        document.getElementById(`step${currentStep}`).classList.add('active');
        document.getElementById('prevBtn').disabled = (currentStep === 1);
    }

    window.onload = () => {
        if (params.get('embed')) {
            document.body.classList.add('is-embed');
            // ì„ë² ë“œ ëª¨ë“œ ë°ì´í„° ì ìš© ë¡œì§...
            try {
                if(params.get('t')) titles = decodeURIComponent(atob(params.get('t'))).split('|');
                if(params.get('p')) particles = decodeURIComponent(atob(params.get('p'))).split('|');
                document.getElementById('wDesc').innerText = decodeURIComponent(atob(params.get('ds') || ""));
                document.getElementById('actionBtn').innerText = decodeURIComponent(atob(params.get('bt') || "Q2hlY2s=")); // Default 'Check'
                if(params.get('img')) document.getElementById('wImg').src = decodeURIComponent(atob(params.get('img')));
                
                // ë°°ê²½ & ìœ„ì¹˜ ì ìš©
                const bg = document.getElementById('bgLayer');
                bg.style.opacity = (params.get('op') || 15) / 100;
                bg.style.background = `#${params.get('th') || 'a4c4e4'}`;
                const iz = (params.get('iz') || 100) / 100;
                document.getElementById('wImg').style.transform = `scale(${iz}) translate(${(params.get('ix')||0)/iz}%, ${(params.get('iy')||0)/iz}%)`;
                document.getElementById('imgContainer').className = `image-container ${params.get('s') || 'square'}`;
                document.getElementById('wTooltip').className = `image-tooltip ${params.get('ts') || 'dark'}`;
                
                // ë‚ ì§œ ì ìš©
                const dateVal = params.get('d');
                if(dateVal) {
                    if(params.get('dd') === 'date') document.getElementById('wDday').innerText = dateVal.replace(/-/g, '.');
                    else {
                        const diff = Math.floor((new Date().setHours(0,0,0,0) - new Date(dateVal).setHours(0,0,0,0)) / 86400000);
                        document.getElementById('wDday').innerText = diff >= 0 ? `D+${diff}` : `D${diff}`;
                    }
                }
            } catch(e) { console.error("Link Error", e); }
            
            // íˆ´íŒ ëœë¤ ì´ë²¤íŠ¸
            document.querySelector('.image-wrapper').addEventListener('mouseenter', () => {
                document.getElementById('wTooltip').innerText = titles[Math.floor(Math.random() * titles.length)] || "ê¸°ì–µ";
            });
        } else {
            updatePreview();
        }
    };
</script>
</body>
</html>
